<?php//予定一覧	include('page_header.php');	if (!isset($_SESSION['userid'])){		echo '<div class="text-danger">このサービスを利用するためにログインする必要があります</div>';		include('page_footer.php');		exit;	}	include ('db_inc.php'); 	$vars = array_merge($_GET,$_POST); 	if (isset($vars['today'])){		$view_yr = date('Y');		$view_mt = date('n');	}else{		$view_yr = isset($vars['view_yr']) ? $vars['view_yr'] : date('Y');;		$view_mt = isset($vars['view_mt']) ? $vars['view_mt'] : date('n');		if (isset($vars['prev_mt'])) $view_mt--;		if (isset($vars['next_mt'])) $view_mt++;	}	$time = mktime(0, 0, 0,$view_mt,1, $view_yr);	$start_w = date("w", $time); // 1st day 's week	$last_d  = date("t", $time); // last day	$view_yr = date('Y', $time); // year	$view_mt = date('n', $time); // month	$yrmt_jp = date("Y年n月",$time);	$nowday  = date('Y-n-j');	//　今日の日付//ここからカレンダーを出力。予定のある日にプルダウンリストで予定を確認できる//echo '<h2>マイカレンダー</h2>'; ?><form action="" method="post"><input class="btn btn-info" type="submit" name="today" value="今日"><input class="btn btn-info" type="submit" name="prev_mt" value="&lt;"><input type="hidden" name="view_yr" value="<?php echo $view_yr;?>"><input type="hidden" name="view_mt" value="<?php echo $view_mt;?>"><input class="btn btn-info" type="submit" name="next_mt" value="&gt;"><label class=><?php echo $yrmt_jp;?><input class="btn btn-info" type="submit" name="calender" value="マイカレンダー"><input class="btn btn-info" type="submit" name="calender" value="ビジネス"><input class="btn btn-info" type="submit" name="calender" value="プライベート"></label></form><table class="table table-striped table-hover"><tr><th class="text-danger">日</th><th>月</th><th>火</th><th>水</th><th>木</th><th>金</th><th class="text-primary">土</th></tr><?php	$userid = $_SESSION['userid'];	$event = array();	$d1 = $view_yr . '-' . $view_mt . '-1' ;         // 検索開始日  $d2 = $view_yr . '-' . $view_mt . '-' . $last_d; // 検索終了日	$sql = "SELECT * FROM vw_yotei WHERE userid='{$userid}' AND (kstime BETWEEN '{$d1}' AND '{$d2}') ORDER BY kstime ";	$rs = mysql_query ($sql, $conn);	if (!$rs) die ( 'エラー: ' . mysql_error() );	$events = array();	$row = mysql_fetch_array ($rs);	$has_yotei = ($row) ? true : false;	while ($row){		list($ksdate,$kstime) = explode(' ', $row['kstime']); // split date and time		$events[$ksdate][] = $row; // 開始日でキーとして予定を配列に一時保存しておく		$row = mysql_fetch_array ($rs);	}	echo '<tr>';	for($i=0; $i < $start_w ; $i++){		echo "<td><br></td>";	}	for($d=1; $d<=$last_d; $d++){		$r = ($start_w + $d - 1) % 7 ;		if ($r == 0) echo '<tr>';		$td = '';		$theday = sprintf("%04d-%02d-%02d", $view_yr, $view_mt, $d);		if($nowday == $theday)	$td .=	" bg-danger";//本日の色		if($r == 6) $td .= 	" text-primary";//土曜日の色		if($r == 0) $td .= 	" text-danger";//日曜日の色		$li = '';		if(isset($events[$theday])) 	{			$td .=	" bg-info";		//予定のある日の色				$li .= '<div class="dropdown">';			$li .= '<a href="#" class="dropdown-toggle" data-toggle="dropdown">' . $d;			$li .= '<span class="caret"></span></a>';			$li .= '<ul class="dropdown-menu">';			foreach( $events[$theday] as $e){				list($ksdate,$kstime) = explode(' ', $e['kstime']); 				$kstime = substr($kstime, 0, 5);				$li .= '<li>' . $kstime . ' ' . $e['title'] . '</li>';  			}			$li .= '</ul>';			$li .= '</div>';		}else{			$li = $d;		}		echo "<td class=\"$td\">". $li.'</td>';		if ($r == 6) echo '</tr>';	}	echo '</table>';	// 	これから本月の予定を一覧するリストを作る	if ($has_yotei){		echo '<h2>予定一覧</h2>'; 		echo '<table class="table table-striped table-hover">';		echo '<tr class="">';		echo '<th>日時</th><th>予定名</th><th>場所</th><th>説明</th><th>操作</th>';		echo '</tr>';			foreach ($events as $ksdate=>$list ) {			foreach ($list as $e){				echo '<tr>';				list($y,$m,$d) = explode('-',$ksdate);				$time = mktime(0, 0, 0,$m,$d, $y);				$i = date('w',$time);				$w = array('日','月','火','水','木','金','土');				list(, $kstime ) = explode(' ', $e['kstime']);				list(, $ketime ) = explode(' ', $e['ketime']);				$kstime = substr($kstime, 0, 5);							$ketime = substr($ketime, 0, 5);				$dt = $m . '/' . $d . '(' . $w[$i] .') ' . $kstime . ' - ' . $ketime;				echo '<td>' . $dt . '</td>';				echo '<td>' . $e ['title'] . '</td>';				echo '<td>' . $e ['place'] . '</td>';				echo '<td>' . $e ['kmemo'] . '</td>';				//echo '<td>' . $e ['cname'] . '</td>';				echo '<td><a class="btn btn-primary" href="schedule_edit.php?kid='. $e['kid'] . '">編集</a>&nbsp;';				echo '<a class="btn btn-danger" href="schedule_delete.php?kid='. $e['kid']. '">削除</a></td>';					echo '</tr>';			}		}		echo '</table>';	}?><?php include('page_footer.php');?>